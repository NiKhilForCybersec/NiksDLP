<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Microsoft Purview Endpoint DLP deployment guide including onboarding, monitored activities, configuration, and troubleshooting.">
  <title>Purview Endpoint DLP | DLP Documentation Hub</title>
  <link rel="stylesheet" href="../../css/main.css">
</head>
<body>
  <button class="mobile-menu-btn" aria-label="Toggle navigation" aria-expanded="false">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </button>
  
  <div class="sidebar-overlay"></div>
  
  <div class="page-wrapper">
    <aside class="sidebar">
      <div class="sidebar-header">
        <a href="../../index.html" class="sidebar-logo">
          <svg viewBox="0 0 32 32" fill="none">
            <rect x="2" y="4" width="28" height="24" rx="2" stroke="currentColor" stroke-width="2"/>
            <path d="M16 12L22 18L16 24" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
            <path d="M10 18H22" stroke="#3b82f6" stroke-width="2" stroke-linecap="round"/>
          </svg>
          DLP Docs
        </a>
      </div>
      
      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Microsoft Purview</div>
          <a href="purview-overview.html" class="nav-link" data-product="purview">Overview & Licensing</a>
          <a href="purview-architecture.html" class="nav-link" data-product="purview">Architecture</a>
          <a href="purview-endpoint-dlp.html" class="nav-link active" data-product="purview">Endpoint DLP</a>
          <a href="purview-sensitive-info-types.html" class="nav-link" data-product="purview">Sensitive Info Types</a>
          <a href="purview-policies.html" class="nav-link" data-product="purview">DLP Policies</a>
          <a href="purview-labels.html" class="nav-link" data-product="purview">Sensitivity Labels</a>
          <a href="../operations/dlp-alerts.html" class="nav-link" data-product="purview">Alerts & Activity Explorer</a>
          <a href="../operations/reporting-metrics.html" class="nav-link" data-product="purview">Reports</a>
        </div>
        
        <div class="nav-section">
          <div class="nav-section-title">Related</div>
          <a href="../endpoint/edlp-channels.html" class="nav-link" data-product="endpoint">Endpoint Channels</a>
          <a href="../endpoint/edlp-comparison.html" class="nav-link" data-product="endpoint">Vendor Comparison</a>
          <a href="../troubleshooting/troubleshooting-purview.html" class="nav-link">Troubleshooting</a>
        </div>
      </nav>
    </aside>
    
    <main class="main-content">
      <div class="content-wrapper">
        <nav class="breadcrumbs">
          <a href="../../index.html">Home</a>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
          <a href="purview-overview.html">Microsoft Purview</a>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="9 18 15 12 9 6"></polyline>
          </svg>
          <span>Endpoint DLP</span>
        </nav>
        
        <h1>Microsoft Purview Endpoint DLP</h1>
        
        <p>Endpoint DLP extends Microsoft Purview data loss prevention to Windows and macOS devices. It monitors user activities on sensitive content and enables protective actions like blocking, auditing, or warning users when they attempt to share sensitive data through various channels.</p>
        
        <div class="callout info">
          <div class="callout-header">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="12" y1="16" x2="12" y2="12"></line>
              <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
            Key Benefit
          </div>
          <p>Endpoint DLP uses the same Microsoft Defender for Endpoint (MDE) agent for device onboarding—no additional agent deployment required if you're already using MDE.</p>
        </div>
        
        <h2 id="prerequisites">Prerequisites</h2>
        
        <h3>Licensing Requirements</h3>
        
        <p>Endpoint DLP requires one of the following licenses:</p>
        
        <ul>
          <li>Microsoft 365 E5/A5/G5</li>
          <li>Microsoft 365 E5/A5/G5 Compliance</li>
          <li>Microsoft 365 E5/A5/G5 Information Protection & Governance</li>
          <li>Office 365 E5 + Enterprise Mobility + Security E5</li>
        </ul>
        
        <h3>Operating System Requirements</h3>
        
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Platform</th>
                <th>Minimum Version</th>
                <th>Notes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Windows 10</td>
                <td>Version 1809 (Build 17763)</td>
                <td>Enterprise, Pro, Education editions</td>
              </tr>
              <tr>
                <td>Windows 11</td>
                <td>All versions</td>
                <td>Enterprise, Pro, Education editions</td>
              </tr>
              <tr>
                <td>Windows Server</td>
                <td>2019 / 2022</td>
                <td>Limited channel support</td>
              </tr>
              <tr>
                <td>macOS</td>
                <td>Catalina 10.15+</td>
                <td>Requires MDE for macOS</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <h3>Network Requirements</h3>
        
        <p>Devices must have connectivity to Microsoft cloud services. Ensure the following URLs are accessible:</p>
        
        <div class="code-block" data-language="text">
          <div class="code-header">
            <span class="code-lang">URLs</span>
            <button class="code-copy">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
          <pre><code># Microsoft Defender for Endpoint
*.security.microsoft.com
*.securitycenter.windows.com
login.microsoftonline.com
*.blob.core.windows.net

# Microsoft Purview / Compliance
compliance.microsoft.com
*.compliance.microsoft.com
dataservice.protection.outlook.com

# Certificate validation
crl.microsoft.com
ctldl.windowsupdate.com</code></pre>
        </div>
        
        <h2 id="onboarding">Device Onboarding</h2>
        
        <p>Devices must be onboarded to both Microsoft Defender for Endpoint and Microsoft Purview. If already onboarded to MDE, you only need to enable Endpoint DLP in the compliance portal.</p>
        
        <div class="tabs">
          <div class="tab-list" role="tablist">
            <button class="tab-button active" role="tab">Intune</button>
            <button class="tab-button" role="tab">Group Policy</button>
            <button class="tab-button" role="tab">SCCM/ConfigMgr</button>
            <button class="tab-button" role="tab">Local Script</button>
          </div>
          
          <div class="tab-panel active">
            <h3>Microsoft Intune Onboarding</h3>
            
            <ol class="steps">
              <li>
                <strong>Create Configuration Profile</strong>
                <p>Navigate to Microsoft Intune admin center → Endpoint security → Endpoint detection and response → Create policy.</p>
              </li>
              <li>
                <strong>Configure EDR Settings</strong>
                <p>Select Windows 10/11 platform, set sample sharing to "All", enable expedited telemetry.</p>
              </li>
              <li>
                <strong>Assign to Device Groups</strong>
                <p>Target pilot groups first, then expand to all managed devices.</p>
              </li>
              <li>
                <strong>Enable Endpoint DLP</strong>
                <p>In Microsoft Purview compliance portal → Settings → Device onboarding → Turn on device monitoring.</p>
              </li>
            </ol>
            
            <div class="code-block" data-language="json">
              <div class="code-header">
                <span class="code-lang">Intune CSP Settings</span>
                <button class="code-copy">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                  Copy
                </button>
              </div>
              <pre><code>{
  "@odata.type": "#microsoft.graph.windows10EndpointProtectionConfiguration",
  "defenderAdvancedRansomewareProtectionType": "enable",
  "defenderSecurityCenterNotificationsFromApp": "blockNoncriticalNotifications",
  "defenderCloudBlockLevel": "high",
  "defenderCloudExtendedTimeoutInSeconds": 50,
  "defenderSubmitSamplesConsentType": "sendSafeSamplesAutomatically"
}</code></pre>
            </div>
          </div>
          
          <div class="tab-panel">
            <h3>Group Policy Onboarding</h3>
            
            <ol class="steps">
              <li>
                <strong>Download Onboarding Package</strong>
                <p>From Microsoft Defender Security Center → Settings → Endpoints → Onboarding → Download package (Group Policy).</p>
              </li>
              <li>
                <strong>Extract ADMX Templates</strong>
                <p>Copy WindowsDefenderATPOnboarding.xml to a network share accessible by target machines.</p>
              </li>
              <li>
                <strong>Create GPO</strong>
                <p>Computer Configuration → Policies → Administrative Templates → Windows Components → Microsoft Defender ATP.</p>
              </li>
              <li>
                <strong>Configure Onboarding</strong>
                <p>Enable "Onboard to Microsoft Defender ATP" and specify the onboarding package path.</p>
              </li>
            </ol>
            
            <div class="code-block" data-language="powershell">
              <div class="code-header">
                <span class="code-lang">PowerShell - Verify GPO Deployment</span>
                <button class="code-copy">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                  Copy
                </button>
              </div>
              <pre><code># Force GPO update
gpupdate /force

# Verify MDE onboarding via registry
Get-ItemProperty -Path "HKLM:\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status" `
    -Name OnboardingState

# Expected: OnboardingState = 1 (Onboarded)

# Verify via service
Get-Service -Name Sense | Select-Object Status, StartType
# Expected: Running, Automatic</code></pre>
            </div>
          </div>
          
          <div class="tab-panel">
            <h3>SCCM / Configuration Manager Onboarding</h3>
            
            <ol class="steps">
              <li>
                <strong>Enable Cloud Attachment</strong>
                <p>SCCM must be cloud-attached to Microsoft Endpoint Manager for MDE integration.</p>
              </li>
              <li>
                <strong>Create Endpoint Protection Policy</strong>
                <p>Assets and Compliance → Endpoint Protection → Microsoft Defender for Endpoint Policies.</p>
              </li>
              <li>
                <strong>Deploy to Collection</strong>
                <p>Target your device collection with the MDE onboarding policy.</p>
              </li>
              <li>
                <strong>Monitor Compliance</strong>
                <p>Use SCCM reporting to track onboarding status across devices.</p>
              </li>
            </ol>
            
            <div class="callout tip">
              <div class="callout-header">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                  <line x1="12" y1="17" x2="12.01" y2="17"></line>
                </svg>
                SCCM Tip
              </div>
              <p>For SCCM 2111+, use the built-in "Tenant Attach" feature to push MDE onboarding through co-management with Intune.</p>
            </div>
          </div>
          
          <div class="tab-panel">
            <h3>Local Script Onboarding</h3>
            
            <p>For testing or small deployments, use the local onboarding script:</p>
            
            <div class="code-block" data-language="powershell">
              <div class="code-header">
                <span class="code-lang">PowerShell - Local Onboarding</span>
                <button class="code-copy">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                  Copy
                </button>
              </div>
              <pre><code># Download onboarding package from:
# security.microsoft.com → Settings → Endpoints → Onboarding → Local Script

# Run as Administrator
cd "C:\Path\To\OnboardingPackage"
.\WindowsDefenderATPLocalOnboardingScript.cmd

# Verify onboarding status
$regPath = "HKLM:\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
$status = Get-ItemProperty -Path $regPath -ErrorAction SilentlyContinue

if ($status.OnboardingState -eq 1) {
    Write-Host "Device is onboarded to MDE" -ForegroundColor Green
    Write-Host "OrgId: $($status.OrgId)"
} else {
    Write-Host "Device is NOT onboarded" -ForegroundColor Red
}

# Test connectivity to MDE cloud
$testUrl = "https://winatp-gw-cus.microsoft.com/test"
try {
    $response = Invoke-WebRequest -Uri $testUrl -UseBasicParsing
    Write-Host "Connectivity test: PASSED" -ForegroundColor Green
} catch {
    Write-Host "Connectivity test: FAILED" -ForegroundColor Red
}</code></pre>
            </div>
          </div>
        </div>
        
        <h2 id="monitored-activities">Monitored Activities</h2>
        
        <p>Endpoint DLP monitors the following user activities on sensitive content:</p>
        
        <div class="ascii-diagram">
          <pre>
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    ENDPOINT DLP MONITORED ACTIVITIES                             │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  <span class="accent-green">REMOVABLE STORAGE</span>                    <span class="accent-cyan">CLOUD SERVICES</span>                           │
│  ├─ Copy to USB drive                 ├─ Upload to browser                      │
│  ├─ Copy to external HDD              ├─ OneDrive/SharePoint sync               │
│  ├─ Copy to SD card                   ├─ Dropbox, Google Drive                  │
│  └─ Write to removable media          └─ Box, other cloud apps                  │
│                                                                                  │
│  <span class="accent-orange">NETWORK SHARE</span>                         <span class="accent-purple">APPLICATIONS</span>                             │
│  ├─ Copy to network share (UNC)       ├─ Access by unallowed apps               │
│  ├─ Move to network location          ├─ Paste to restricted app                │
│  └─ Save to mapped drive              └─ Copy from sensitive file               │
│                                                                                  │
│  <span class="accent-blue">PRINT</span>                                 <span class="accent-green">CLIPBOARD</span>                                │
│  ├─ Print to physical printer         ├─ Copy to clipboard                      │
│  ├─ Print to network printer          ├─ Paste sensitive content                │
│  ├─ Print to PDF                      └─ Screen capture                         │
│  └─ Print to XPS                                                                │
│                                                                                  │
│  <span class="accent-cyan">BLUETOOTH</span>                             <span class="accent-orange">RDP/REMOTE</span>                               │
│  ├─ Send via Bluetooth                ├─ Copy to RDP clipboard                  │
│  └─ Bluetooth file transfer           └─ Access via remote session              │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
          </pre>
        </div>
        
        <h3>Activity Details</h3>
        
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Activity</th>
                <th>Windows</th>
                <th>macOS</th>
                <th>Policy Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Copy to USB/removable</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge supported">✓</span></td>
                <td>Audit, Warn, Block</td>
              </tr>
              <tr>
                <td>Copy to network share</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge supported">✓</span></td>
                <td>Audit, Warn, Block</td>
              </tr>
              <tr>
                <td>Upload via browser</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge supported">✓</span></td>
                <td>Audit, Warn, Block</td>
              </tr>
              <tr>
                <td>Print</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge supported">✓</span></td>
                <td>Audit, Warn, Block</td>
              </tr>
              <tr>
                <td>Copy to clipboard</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge partial">Limited</span></td>
                <td>Audit only</td>
              </tr>
              <tr>
                <td>Access by unallowed app</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge supported">✓</span></td>
                <td>Audit, Warn, Block</td>
              </tr>
              <tr>
                <td>Bluetooth transfer</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge unsupported">✗</span></td>
                <td>Audit, Warn, Block</td>
              </tr>
              <tr>
                <td>RDP clipboard</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge unsupported">✗</span></td>
                <td>Audit, Warn, Block</td>
              </tr>
              <tr>
                <td>Screen capture</td>
                <td><span class="status-badge supported">✓</span></td>
                <td><span class="status-badge unsupported">✗</span></td>
                <td>Audit only</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <h2 id="configuration">Endpoint DLP Settings</h2>
        
        <h3>Global Settings</h3>
        
        <p>Configure global Endpoint DLP settings in Microsoft Purview compliance portal → Data loss prevention → Endpoint DLP settings:</p>
        
        <div class="accordion">
          <div class="accordion-item active">
            <button class="accordion-header" aria-expanded="true">
              File Path Exclusions
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                <p>Exclude specific paths from DLP monitoring to reduce noise and performance impact:</p>
                
                <div class="code-block" data-language="text">
                  <div class="code-header">
                    <span class="code-lang">Recommended Exclusions</span>
                    <button class="code-copy">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                      </svg>
                      Copy
                    </button>
                  </div>
                  <pre><code># Windows system paths
C:\Windows\
C:\Program Files\
C:\Program Files (x86)\
C:\ProgramData\Microsoft\

# Temp folders (careful - may miss exfil attempts)
%TEMP%
%TMP%

# Application-specific (add based on your environment)
C:\Users\*\AppData\Local\Microsoft\
C:\Users\*\AppData\Local\Temp\

# macOS system paths
/System/
/Library/
/usr/</code></pre>
                </div>
                
                <div class="callout warning">
                  <div class="callout-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                      <line x1="12" y1="9" x2="12" y2="13"></line>
                      <line x1="12" y1="17" x2="12.01" y2="17"></line>
                    </svg>
                    Warning
                  </div>
                  <p>Be cautious with exclusions. Adversaries often stage data in temp folders before exfiltration. Only exclude paths after careful risk assessment.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <button class="accordion-header" aria-expanded="false">
              Unallowed Apps
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                <p>Block or monitor when sensitive files are accessed by specific applications:</p>
                
                <div class="code-block" data-language="text">
                  <div class="code-header">
                    <span class="code-lang">Example Unallowed Apps</span>
                    <button class="code-copy">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                      </svg>
                      Copy
                    </button>
                  </div>
                  <pre><code># Cloud sync clients (if not approved)
dropbox.exe
googledrivesync.exe
boxsync.exe

# File transfer tools
winscp.exe
filezilla.exe
putty.exe

# Archive tools (potential exfiltration)
7z.exe
winrar.exe
winzip.exe

# Screenshot tools
snagit.exe
greenshot.exe
lightshot.exe

# Note: Blocking legitimate business apps causes disruption
# Start with Audit mode to understand impact</code></pre>
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <button class="accordion-header" aria-expanded="false">
              Unallowed Browsers
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                <p>Restrict which browsers can upload sensitive files. By default, Edge, Chrome, and Firefox are allowed with the Purview browser extension:</p>
                
                <div class="code-block" data-language="text">
                  <div class="code-header">
                    <span class="code-lang">Browser Configuration</span>
                    <button class="code-copy">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                      </svg>
                      Copy
                    </button>
                  </div>
                  <pre><code># Allowed browsers (with extension)
msedge.exe      # Microsoft Edge
chrome.exe      # Google Chrome
firefox.exe     # Mozilla Firefox

# Commonly blocked browsers
opera.exe
brave.exe
vivaldi.exe
tor.exe         # Tor Browser - high risk

# Browser extension IDs
Edge:   echcggldkblhodogklpincgchnpgcdco
Chrome: echcggldkblhodogklpincgchnpgcdco
Firefox: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="670a0e041508140801134a04080a170b0e060904024a021f130209140e0809270a0e041508140801134904080a">[email&#160;protected]</a></code></pre>
                </div>
                
                <div class="callout info">
                  <div class="callout-header">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <circle cx="12" cy="12" r="10"></circle>
                      <line x1="12" y1="16" x2="12" y2="12"></line>
                      <line x1="12" y1="8" x2="12.01" y2="8"></line>
                    </svg>
                    Note
                  </div>
                  <p>The Microsoft Purview browser extension is required for upload monitoring in Chrome and Firefox. Deploy via GPO or Intune.</p>
                </div>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <button class="accordion-header" aria-expanded="false">
              VPN Settings
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                <p>Define corporate VPN settings to allow different policy actions for on-network vs. off-network devices:</p>
                
                <div class="code-block" data-language="json">
                  <div class="code-header">
                    <span class="code-lang">VPN Configuration</span>
                    <button class="code-copy">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                      </svg>
                      Copy
                    </button>
                  </div>
                  <pre><code>{
  "vpnSettings": {
    "serverAddresses": [
      "vpn.contoso.com",
      "10.0.0.0/8",
      "172.16.0.0/12"
    ],
    "vpnProviderNames": [
      "Cisco AnyConnect",
      "GlobalProtect",
      "Zscaler"
    ]
  }
}</code></pre>
                </div>
                
                <p>Use VPN detection in policies to apply stricter controls when users are off-network.</p>
              </div>
            </div>
          </div>
          
          <div class="accordion-item">
            <button class="accordion-header" aria-expanded="false">
              Network Exceptions (Service Domains)
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="6 9 12 15 18 9"></polyline>
              </svg>
            </button>
            <div class="accordion-content">
              <div class="accordion-body">
                <p>Allow sensitive file uploads to approved cloud services:</p>
                
                <div class="code-block" data-language="text">
                  <div class="code-header">
                    <span class="code-lang">Service Domain Allowlist</span>
                    <button class="code-copy">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                        <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                      </svg>
                      Copy
                    </button>
                  </div>
                  <pre><code># Microsoft services (usually allowed)
*.sharepoint.com
*.onedrive.com
*.office.com
*.microsoft.com

# Corporate applications
yourcompany.servicenow.com
yourcompany.salesforce.com
yourcompany.workday.com

# Approved file sharing
*.box.com (if approved)

# Do NOT add personal cloud services
# dropbox.com - BLOCK
# drive.google.com - BLOCK (unless using Google Workspace)</code></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <h2 id="business-justification">Business Justification</h2>
        
        <p>When a user attempts an action that triggers a DLP policy, they can be prompted to provide a business justification. This creates an audit trail and allows legitimate business needs to proceed with documentation.</p>
        
        <h3>Justification Options</h3>
        
        <ul>
          <li><strong>False Positive</strong> — User indicates the detection was incorrect</li>
          <li><strong>Business Justification</strong> — User explains why they need to perform the action</li>
          <li><strong>Override with Reason</strong> — User selects a pre-defined reason code</li>
        </ul>
        
        <div class="code-block" data-language="powershell">
          <div class="code-header">
            <span class="code-lang">PowerShell - Configure Business Justification</span>
            <button class="code-copy">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
          <pre><code># Example DLP policy rule with business justification
$ruleParams = @{
    Name = "Block PII to USB with Override"
    Policy = "Endpoint PII Protection"
    ContentContainsSensitiveInformation = @(
        @{Name = "U.S. Social Security Number (SSN)"; minCount = 1},
        @{Name = "Credit Card Number"; minCount = 1}
    )
    BlockAccess = $true
    BlockAccessScope = "All"
    NotifyUser = "LastModifier"
    NotifyUserType = "PolicyTip"
    # Allow override with business justification
    GenerateIncidentReport = $true
    IncidentReportContent = "All"
    NotifyOverride = @(
        "WithJustification",
        "FalsePositive"
    )
}

New-DlpComplianceRule @ruleParams</code></pre>
        </div>
        
        <h2 id="activity-explorer">Activity Explorer & DLP Alerts</h2>
        
        <p>Monitor Endpoint DLP activity through the Microsoft Purview compliance portal:</p>
        
        <h3>Key Views</h3>
        
        <ul>
          <li><strong>Activity Explorer</strong> — All DLP events across endpoints, Exchange, SharePoint, and cloud apps</li>
          <li><strong>DLP Alerts</strong> — Aggregated alerts based on policy severity and match count</li>
          <li><strong>Content Explorer</strong> — Browse discovered sensitive content</li>
        </ul>
        
        <h3>KQL Queries for Activity Explorer</h3>
        
        <div class="code-block" data-language="kql">
          <div class="code-header">
            <span class="code-lang">KQL</span>
            <button class="code-copy">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
          <pre><code>// All Endpoint DLP events in last 7 days
DLPActionEvents
| where Timestamp > ago(7d)
| where Workload == "Endpoint"
| project Timestamp, User, FileName, ActionType, PolicyName, SensitiveInfoType
| order by Timestamp desc

// USB copy attempts blocked
DLPActionEvents
| where Timestamp > ago(30d)
| where ActionType == "FileCopiedToRemovableMedia"
| where ActionResult == "Blocked"
| summarize Count = count() by User, PolicyName
| order by Count desc

// Top users triggering DLP policies
DLPActionEvents
| where Timestamp > ago(30d)
| where Workload == "Endpoint"
| summarize EventCount = count() by User
| order by EventCount desc
| take 20

// Files with credit card numbers copied to USB
DLPActionEvents
| where Timestamp > ago(7d)
| where SensitiveInfoType contains "Credit Card"
| where ActionType == "FileCopiedToRemovableMedia"
| project Timestamp, User, FileName, DeviceName, ActionResult

// Business justification overrides
DLPActionEvents
| where Timestamp > ago(30d)
| where OverrideJustification != ""
| project Timestamp, User, FileName, PolicyName, OverrideJustification
| order by Timestamp desc</code></pre>
        </div>
        
        <h2 id="troubleshooting">Troubleshooting</h2>
        
        <h3>Verify Onboarding Status</h3>
        
        <div class="code-block" data-language="powershell">
          <div class="code-header">
            <span class="code-lang">PowerShell - Diagnostic Commands</span>
            <button class="code-copy">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
          <pre><code># Check MDE onboarding status
$regPath = "HKLM:\SOFTWARE\Microsoft\Windows Advanced Threat Protection\Status"
$status = Get-ItemProperty -Path $regPath -ErrorAction SilentlyContinue

Write-Host "=== MDE Onboarding Status ===" -ForegroundColor Cyan
Write-Host "OnboardingState: $($status.OnboardingState)" # 1 = Onboarded
Write-Host "OrgId: $($status.OrgId)"
Write-Host "SenseIsRunning: $($status.SenseIsRunning)"

# Check Sense service (MDE)
Write-Host "`n=== MDE Service Status ===" -ForegroundColor Cyan
Get-Service -Name Sense | Format-Table Name, Status, StartType

# Check DLP-specific components
Write-Host "`n=== DLP Components ===" -ForegroundColor Cyan
Get-Service -Name "diagtrack" | Format-Table Name, Status, StartType
Get-Process -Name "MsSense" -ErrorAction SilentlyContinue | 
    Format-Table ProcessName, Id, CPU

# Check Endpoint DLP policy sync
$dlpRegPath = "HKLM:\SOFTWARE\Microsoft\Windows Defender\Policy Manager"
if (Test-Path $dlpRegPath) {
    Write-Host "`n=== DLP Policy Sync ===" -ForegroundColor Cyan
    Get-ItemProperty -Path $dlpRegPath | Format-List
}

# Verify network connectivity
Write-Host "`n=== Network Connectivity ===" -ForegroundColor Cyan
$testUrls = @(
    "https://winatp-gw-cus.microsoft.com/test",
    "https://compliance.microsoft.com",
    "https://dataservice.protection.outlook.com"
)

foreach ($url in $testUrls) {
    try {
        $response = Invoke-WebRequest -Uri $url -UseBasicParsing -TimeoutSec 10
        Write-Host "$url - OK" -ForegroundColor Green
    } catch {
        Write-Host "$url - FAILED" -ForegroundColor Red
    }
}</code></pre>
        </div>
        
        <h3>Event Log Locations</h3>
        
        <div class="code-block" data-language="powershell">
          <div class="code-header">
            <span class="code-lang">PowerShell - Event Logs</span>
            <button class="code-copy">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
          <pre><code># MDE operational events
Get-WinEvent -LogName "Microsoft-Windows-Windows Defender/Operational" -MaxEvents 50 |
    Where-Object { $_.Id -in @(1116, 1117, 1118, 1119) } |
    Format-Table TimeCreated, Id, Message -Wrap

# Sense service events
Get-WinEvent -LogName "Microsoft-Windows-SENSE/Operational" -MaxEvents 20 |
    Format-Table TimeCreated, Id, Message -Wrap

# DLP-specific events (Event ID 1133 = DLP match)
Get-WinEvent -FilterHashtable @{
    LogName = 'Microsoft-Windows-Windows Defender/Operational'
    Id = 1133
    StartTime = (Get-Date).AddDays(-7)
} -ErrorAction SilentlyContinue |
    Format-Table TimeCreated, Message -Wrap</code></pre>
        </div>
        
        <h3>Common Issues</h3>
        
        <div class="table-wrapper">
          <table>
            <thead>
              <tr>
                <th>Issue</th>
                <th>Possible Cause</th>
                <th>Resolution</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Device not appearing in Purview</td>
                <td>MDE onboarding incomplete</td>
                <td>Run onboarding script, check Sense service</td>
              </tr>
              <tr>
                <td>Policies not applying</td>
                <td>Policy sync delay or scope issue</td>
                <td>Wait 2 hours, verify device is in policy scope</td>
              </tr>
              <tr>
                <td>No USB events detected</td>
                <td>File path exclusion too broad</td>
                <td>Review exclusion settings</td>
              </tr>
              <tr>
                <td>Browser upload not blocked</td>
                <td>Missing browser extension</td>
                <td>Deploy Purview extension to Chrome/Firefox</td>
              </tr>
              <tr>
                <td>High CPU on endpoint</td>
                <td>Scanning too many files</td>
                <td>Add appropriate file path exclusions</td>
              </tr>
              <tr>
                <td>Activity Explorer empty</td>
                <td>Diagnostic data settings disabled</td>
                <td>Set diagnostic data to "Required" minimum</td>
              </tr>
            </tbody>
          </table>
        </div>
        
        <h3>MDE Client Analyzer</h3>
        
        <p>Use the Microsoft Defender for Endpoint Client Analyzer for comprehensive diagnostics:</p>
        
        <div class="code-block" data-language="powershell">
          <div class="code-header">
            <span class="code-lang">PowerShell</span>
            <button class="code-copy">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
              </svg>
              Copy
            </button>
          </div>
          <pre><code># Download MDE Client Analyzer
# https://aka.ms/MDEClientAnalyzer

# Extract and run
Expand-Archive -Path MDEClientAnalyzer.zip -DestinationPath C:\MDEAnalyzer
cd C:\MDEAnalyzer
.\MDEClientAnalyzer.cmd

# Results saved to:
# C:\MDEAnalyzer\MDEClientAnalyzerResult\</code></pre>
        </div>
        
        <nav class="page-nav">
          <a href="purview-architecture.html" class="page-nav-link prev">
            <span class="page-nav-label">Previous</span>
            <span class="page-nav-title">Purview Architecture</span>
          </a>
          <a href="purview-sensitive-info-types.html" class="page-nav-link next">
            <span class="page-nav-label">Next</span>
            <span class="page-nav-title">Sensitive Info Types</span>
          </a>
        </nav>
      </div>
    </main>
  </div>
  
  <script src="../../js/main.js"></script>
</body>
</html>
